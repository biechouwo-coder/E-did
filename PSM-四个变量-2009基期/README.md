# PSM倾向得分匹配分析（四个匹配变量）

## 分析说明

本文件夹包含使用四个匹配变量进行的PSM（倾向得分匹配）分析代码和结果。

### 分析设定

- **基期年份**: 2009年
- **匹配变量**:
  - ln_real_gdp（实际GDP对数）
  - In_人口密度（人口密度对数）
  - In_金融发展水平（金融发展水平对数）
  - 第二产业占GDP比重
- **匹配方法**: 1:1有放回匹配
- **卡尺**: 倾向得分对数几率的标准差的0.25倍

## 文件说明

### 核心文件

1. **psm_analysis_4vars.py** - PSM分析主脚本
   - 完整的PSM分析流程
   - 包含数据预处理、匹配、结果评估和可视化

2. **run_psm_4vars.bat** - 批处理运行文件
   - Windows系统双击即可运行分析

3. **check_data.py** - 数据检查脚本
   - 用于检查数据集结构和变量

### 输出文件

运行分析后将生成以下文件：

1. **匹配前比较_四个变量.xlsx** - 匹配前各变量的描述性统计比较
2. **匹配后比较_四个变量.xlsx** - 匹配后各变量的描述性统计比较
3. **PSM匹配结果汇总_四个变量.xlsx** - 整体匹配结果汇总
4. **匹配后数据集_四个变量.xlsx** - 匹配后的完整数据集
5. **PSM匹配结果可视化_四个变量.png** - 可视化图表
6. **PSM分析报告_四个变量.txt** - 详细文本分析报告

## 使用方法

### 方法一：使用批处理文件（推荐）

1. 双击 `run_psm_4vars.bat` 文件
2. 等待分析完成
3. 查看生成的结果文件

### 方法二：使用Python命令行

```bash
cd PSM-四个变量-2009基期
python psm_analysis_4vars.py
```

## 分析流程

脚本将执行以下步骤：

1. **数据读取**: 读取总数据集（2007-2019）
2. **基期提取**: 提取2009年作为基期数据
3. **变量检查**: 验证所有匹配变量是否存在
4. **数据预处理**: 删除缺失值，准备匹配数据
5. **匹配前分析**: 计算各变量的标准化偏差和显著性检验
6. **倾向得分计算**: 使用Logistic回归计算倾向得分
7. **卡尺计算**: 计算匹配卡尺（0.25倍标准差）
8. **执行匹配**: 1:1有放回匹配
9. **匹配后分析**: 评估匹配效果
10. **结果输出**: 生成表格、图表和报告

## 注意事项

1. **处理组变量**: 脚本会自动检测处理组变量。如果数据中没有明确的试点政策变量，将创建一个虚拟变量。实际使用时请根据数据调整处理组变量名称。

2. **数据要求**: 确保 `../总数据集2007-2019_含碳排放强度.xlsx` 文件存在于上级目录。

3. **Python环境**: 需要安装以下Python包：
   - pandas
   - numpy
   - scikit-learn
   - matplotlib
   - seaborn
   - scipy
   - openpyxl

## 安装依赖包

如果尚未安装所需的Python包，可以运行：

```bash
pip install pandas numpy scikit-learn matplotlib seaborn scipy openpyxl
```

## 匹配质量评估标准

- **优秀**: 匹配后标准化偏差 < 10%
- **良好**: 匹配后标准化偏差 < 20%
- **需改进**: 匹配后标准化偏差 ≥ 20%

## 技术支持

如有问题，请检查：
1. Python环境是否正确安装
2. 所需的Python包是否已安装
3. 数据文件路径是否正确
4. 数据中是否包含所需的变量

---

生成时间: 2025-02-12
