# 基期PSM分析（2009年基期）

## 分析设置

- **研究范围**: 2007-2019年
- **基期年份**: 2009年
- **匹配变量**:
  - ln_real_gdp（实际GDP对数）
  - ln_人口密度（人口密度对数）
  - ln_金融发展水平（金融发展水平对数）
  - 第二产业占GDP比重
- **匹配方法**: 1:1 有放回匹配
- **卡尺**: 倾向得分对数几率（Logit）标准差的0.25倍

## 文件说明

- `psm_analysis.py`: PSM分析主脚本
- `check_data.py`: 数据检查脚本
- `run_psm.bat`: Windows批处理运行脚本

## 运行方法

### 方法1: 双击运行批处理文件（推荐）
直接双击 `run_psm.bat` 文件即可运行PSM分析

### 方法2: 命令行运行
```bash
cd "c:\Users\HP\Desktop\did-CEADs\基期PSM分析_2009_四变量"
python psm_analysis.py
```

### 方法3: 使用Python IDE
在PyCharm、VSCode等IDE中打开 `psm_analysis.py` 并运行

## 输出文件

运行完成后会生成以下文件：

1. **PSM匹配结果.xlsx** - 包含所有匹配结果
   - 匹配后城市列表
   - 匹配详情
   - 控制组使用情况
   - 平衡性检验
   - 基期数据（含倾向得分）

2. **倾向得分分布.png** - 匹配前后倾向得分对比图

3. **平衡性检验.png** - 变量平衡性可视化

4. **PSM分析报告.txt** - 完整的文字分析报告

## 分析步骤

1. **数据加载与预处理**
   - 读取原始数据
   - 筛选2007-2019年数据
   - 提取2009年基期数据
   - 删除缺失值

2. **计算倾向得分**
   - 使用Logistic回归
   - 基于四个匹配变量计算倾向得分
   - 计算对数几率（Logit）

3. **执行匹配**
   - 1:1有放回匹配
   - 应用卡尺限制（0.25 × SD of Logit PS）
   - 记录匹配结果和控制组使用情况

4. **平衡性检验**
   - 计算各变量的标准化差异
   - 判断是否达到平衡标准（<20%）

5. **结果可视化**
   - 倾向得分分布图
   - 平衡性检验图

6. **导出结果**
   - Excel结果表
   - PNG图表
   - 文字报告

## 注意事项

- 确保原始数据文件 `../总数据集2007-2023_仅含emission城市_更新DID.xlsx` 存在
- 需要安装的Python库：pandas, numpy, sklearn, matplotlib, openpyxl
- 如果运行出错，请检查数据路径和依赖库是否安装

## 依赖安装

如果缺少依赖库，请运行：
```bash
pip install pandas numpy scikit-learn matplotlib openpyxl
```
