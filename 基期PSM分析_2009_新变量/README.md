# 基期PSM分析 (2009年)

## 分析说明

本文件夹包含基于2009年基期的倾向得分匹配(PSM)分析代码。

### 分析设置

- **基期年份**: 2009年
- **协变量**:
  - `ln_real_gdp`: 实际GDP对数
  - `ln_人口密度`: 人口密度对数
  - `ln_金融发展水平`: 金融发展水平对数
  - `第二产业占GDP比重`: 第二产业占GDP比重

- **匹配方法**: 1:1 无放回匹配
- **卡尺**: 倾向得分对数几率(Logit of Propensity Score)标准差的0.25倍

### 文件说明

- `psm_analysis.py`: PSM分析主脚本
- `requirements.txt`: Python依赖包列表

## 使用方法

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 运行分析

```bash
python psm_analysis.py
```

### 3. 输出文件

运行后会生成以下文件:

- `平衡性检验结果.xlsx`: 匹配前后的平衡性检验统计表
- `平衡性检验图.png`: 包含4个子图的可视化结果
- `匹配后城市列表.xlsx`: 成功匹配的城市对及其协变量值
- `PSM分析报告_2009.txt`: 完整的分析报告

## 分析流程

1. **数据准备**: 读取Excel文件,筛选2009年基期数据
2. **倾向得分计算**: 使用Logistic回归计算每个城市被分到处理组的倾向得分
3. **卡尺计算**: 计算logit(PS)的标准差,乘以0.25作为匹配卡尺
4. **执行匹配**: 对每个处理组城市,在控制组中寻找倾向得分最接近且差异在卡尺范围内的城市
5. **平衡性检验**: 检查匹配后各协变量在处理组和控制组之间是否存在显著差异
6. **结果导出**: 生成统计表格、图表和分析报告

## 平衡性检验标准

- **标准化偏差**: 匹配后应小于10%
- **t检验**: p值应大于0.05(不显著)
- **偏差减少**: 匹配后偏差应较匹配前显著减少

## 参数修改

如需修改分析参数,可在`psm_analysis.py`的`main()`函数中调整:

```python
DATA_PATH = '../总数据集2007-2023_仅含emission城市_更新DID.xlsx'  # 数据路径
BASELINE_YEAR = 2009    # 基期年份
CALIPER_MULT = 0.25     # 卡尺倍数
```

## 注意事项

1. 确保数据文件包含以下列:
   - `年份`: 年份变量
   - `is_treated`: 处理组标识(1=处理组, 0=控制组)
   - `城市`: 城市名称
   - 四个协变量列名

2. 如列名不同,请在`prepare_baseline_data()`函数中修改相应的列名参数
