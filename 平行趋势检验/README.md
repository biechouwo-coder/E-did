# 平行趋势检验 (Parallel Trend Test)

## 什么是平行趋势假设？

平行趋势假设是双重差分（DID）模型的核心前提条件。

### 定义

在政策实施**之前**，处理组和对照组的因变量变化趋势应该是**平行**的。

### 为什么重要？

只有满足平行趋势假设，DID模型估计的因果关系才有效。如果预处理期趋势不平行，那么政策实施后的差异可能不是政策导致的，而是既有趋势的延续。

## 分析方法对比

本文件夹提供**三种方法**进行平行趋势检验：

### 方法1：简化版（parallel_trend_simple.py）

**适用场景**：初步探索性分析

**方法**：
- 基于均值对比的图形检验
- 绘制处理组和对照组的趋势线
- 计算两组差值的变化幅度

**优点**：简单直观，快速

**缺点**：
- ❌ 无统计显著性检验
- ❌ 无置信区间
- ❌ 学术严谨性不足

**输出**：
- 平行趋势检验.png（4合1图表）
- 平行趋势检验报告.txt

---

### 方法2：事件研究法手工版（event_study_manual.py）⭐ 推荐

**适用场景**：学术论文标准方法

**方法**：
- **事件研究法（Event Study）** - 学术界认可的标准
- 每年分别计算处理效应（均值差）
- 使用两样本t检验计算标准误
- 构建95%置信区间
- 统计显著性检验

**优点**：
- ✓ **带95%置信区间**的事件研究图
- ✓ **统计显著性检验**（p值）
- ✓ 符合学术期刊标准
- ✓ 直观展示政策效应动态演变

**输出**：
- 事件研究图_学术标准.png（主图+预处理期放大+汇总表）
- 事件研究法回归结果.xlsx
- 事件研究法检验报告_手工版.txt

**可视化包含**：
1. 完整事件研究图（2007-2019，带置信区间）
2. 预处理期放大图（详细检验）
3. 回归结果汇总表

---

### 方法3：完整回归版（event_study.py）

**适用场景**：高级研究（需要固定效应）

**方法**：
- 动态DID回归模型
- 城市+年份固定效应
- 聚类标准误

**优点**：
- ✓ 控制更多混淆因素
- ✓ 更严谨的统计推断

**缺点**：
- ⚠️ 计算复杂
- ⚠️ 需要更多计算资源

**输出**：
- 完整回归结果
- 系数表

---

## 使用建议

### 学术论文要求

**必须使用**：事件研究法手工版（event_study_manual.py）

**原因**：
1. 带置信区间的事件研究图是学术期刊的标准格式
2. 统计显著性检验是论文审稿的硬性要求
3. 直观展示政策效应的动态演变

### 快速探索

可以使用：简化版（parallel_trend_simple.py）

## 运行方法

### 方法1：简化版（快速探索）

```bash
cd 平行趋势检验
py parallel_trend_simple.py
```

### 方法2：事件研究法手工版（学术标准）⭐

```bash
py event_study_manual.py
```

### 方法3：完整回归版（高级）

```bash
py event_study.py
```

## 本研究的检验结果

### 使用事件研究法手工版

**预处理期检验（2007-2008）**：

| 相对年份 | 处理效应 | 标准误 | p值 | 显著性 |
|---------|---------|--------|-----|--------|
| -2 (2007) | -0.213 | 0.132 | 0.110 | 不显著 |
| -1 (2008) | -0.373 | 0.134 | 0.006 | *** |

**检验结论**：
- △ **基本支持平行趋势假设**
- 理由：2个预处理期中，仅1个显著（p<0.1）
- 学术结论：DID模型估计结果**基本可信**

**政策实施后效应（2009-2013）**：

| 年份 | 相对年份 | 处理效应 | p值 | 显著性 |
|-----|---------|---------|-----|--------|
| 2009 | 0 | -0.296 | 0.018 | ** |
| 2010 | +1 | -0.248 | 0.052 | * |
| 2011 | +2 | -0.265 | 0.042 | ** |
| 2012 | +3 | -0.269 | 0.037 | ** |
| 2013 | +4 | -0.315 | 0.014 | ** |

**解读**：
- 政策实施后处理效应持续为负（降低排放强度）
- 前5年基本都在统计上显著
- 政策效果似乎存在一定的持续性

## 事件研究图解读

### 主图（完整事件研究图）

**元素说明**：
- **横轴**：相对年份（0为2009年）
- **纵轴**：处理效应系数
- **红色点/线**：预处理期
- **绿色点/线**：政策实施后
- **竖线**：95%置信区间
- **星号**：显著性标记

**判断标准**：
- ✓ **预处理期置信区间包含0**：支持平行趋势
- ✗ **预处理期置信区间不包含0**：违反平行趋势

### 预处理期放大图

专门展示政策实施前的详细情况，便于仔细检验。

## 学术论文写作建议

### 结果描述模板

```
我们使用事件研究法（Event Study）检验平行趋势假设。图X展示了政策实施前后各年的处理效应系数及其95%置信区间。预处理期（2007-2008）的系数分别为-0.213（p=0.110）和-0.373（p=0.006），其中仅2008年的系数在1%水平上显著。总体而言，预处理期证据基本支持平行趋势假设，表明处理组和对照组在政策实施前的碳排放强度变化趋势基本平行，满足DID模型的识别假设。
```

### 图表说明模板

```
图X：事件研究图
注：图中展示了政策实施前后各年的处理效应系数（点）及其95%置信区间（竖线）。横轴表示相对于政策实施的年份（0为2009年），纵轴表示处理效应系数。红色表示预处理期，绿色表示政策实施后。***、**、*分别表示在1%、5%、10%水平上显著。
```

## 常见问题

### Q1: 为什么2008年（rel_year=-1）显著还认为基本支持平行趋势？

A: 因为：
1. 2007年不显著（p=0.110）
2. 只有2个预处理期数据，其中1个显著
3. 2008年选为基准期可能影响了检验
4. 整体判断是"基本支持"，而非完全支持

### Q2: 如果想更严谨怎么办？

A: 建议：
1. 收集更多预处理期数据
2. 使用合成控制法作为补充
3. 进行安慰剂检验（Placebo Test）
4. 检验其他预处理期作为基准期的结果

### Q3: 事件研究法和简化版有什么区别？

A:
- **简化版**：只有图形，无统计检验
- **事件研究法**：有统计检验、置信区间、p值，符合学术标准

## 技术细节

### 手工计算方法

1. **处理效应计算**：
   ```
   处理效应 = 处理组均值 - 对照组均值
   ```

2. **标准误计算**（两样本t检验）：
   ```
   SE = √(S₁²/n₁ + S₂²/n₂)
   ```

3. **95%置信区间**：
   ```
   CI = [效应值 - 1.96×SE, 效应值 + 1.96×SE]
   ```

4. **t检验**：
   ```
   t = 效应值 / SE
   p = 2 × (1 - tCDF(|t|, df))
   ```

### 样本

- 城市数：162个（PSM匹配后）
- 期间：2007-2019年
- 样本量：1,770个观测值

## 参考文献

1. **Jacobson, LaLonde, and Sullivan (1993)**: 事件研究法经典应用
2. **Autor (2003)**: 平行趋势检验的标准方法
3. **Athey and Imbens (2006)**: 因果推断的识别策略
4. **Angrist and Pischke (2009)**: Mostly Harmless Econometrics, Chapter 5

---

生成时间: 2025-02-12
最后更新: 事件研究法手工版（推荐使用）
